<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Frameset//EN" "http://www.w3.org/TR/html4/frameset.dtd">
<html>
<head>
  <meta charset="utf-8">
  <script language="javascript">
  var API_1484_11 = {
    codeName: 'ScormProxy',
    debug: true,
    apiHandle	 :	null,
    findAPITries :  0,
    noAPIFound	 : false,
    maxTries: 500,
    timeStart: null
  };

  API_1484_11.Initialize = function() {
    this.log('Initialize');
    var api = this.getAPIHandle();
    if(!this.noAPIFound){
      var dateStart = new Date();
      this.timeStart = dateStart.getTime();
      return api.LMSInitialize("");
    }
    return false;
  };

  API_1484_11.Terminate = function() {
    this.log('Terminate');
    var api = this.getAPIHandle();
    if(!this.noAPIFound){
      var dateEnd = new Date();
      var timeEnd = dateEnd.getTime();
      var tps_passe = (Math.floor(timeEnd - this.timeStart)) / 1000;
      this.log(this.formatTime(tps_passe));
      api.LMSSetValue('cmi.core.session_time', this.formatTime(tps_passe));
      return api.LMSFinish("");
    }
    return false;
  };

  API_1484_11.GetValue = function(key) {
    this.log('GetValue : ' + key);
    var api = this.getAPIHandle();
    if(!this.noAPIFound){
      switch(key) {
        case 'cmi.location':
          var status = api.LMSGetValue('cmi.core.lesson_status');
          if(status != 'incomplete') {
            return '';
          }
          return api.LMSGetValue('cmi.core.lesson_location');
          break;
        case 'cmi.completion_status'://TODO
          var status = api.LMSGetValue('cmi.core.lesson_status');
          if (status == 'passed'|| status == 'failed') {
            return 'completed';
          } else {
            return 'incomplete';
          }
          break;
        case 'cmi.success_status':
          var status = api.LMSGetValue('cmi.core.lesson_status');
          if (status == 'completed') {
            return 'passed';
          } else {
            return 'not attempted';
          }
          break;
        case 'cmi.progress_measure':
          return ''; //TODO
          break;
        case 'cmi.learner_id':
          return api.LMSGetValue('cmi.core.student_id');
          break;
        case 'cmi.learner_name':
          return api.LMSGetValue('cmi.core.student_name');
          break;
        case 'cmi.score.raw':
          return api.LMSGetValue('cmi.core.score.raw');
          break;
        case 'cmi.score.min':
          return api.LMSGetValue('cmi.core.score.min');
          break;
        case 'cmi.score.max':
          return api.LMSGetValue('cmi.core.score.max');
          break;
        default :
          return api.LMSGetValue(key);
          break;
      }
    }
    return '';
  };

  API_1484_11.SetValue = function(key, val) {
    this.log('SetValue : ' + key + ' / ' + val);
    var api = this.getAPIHandle();
    if(!this.noAPIFound){
      switch(key) {
        case 'cmi.score.min':
          return api.LMSSetValue('cmi.core.score.min', val);
          break;
        case 'cmi.score.max':
          return api.LMSSetValue('cmi.core.score.max', val);
          break;
        case 'cmi.score.raw':
          return api.LMSSetValue('cmi.core.score.raw', val);
          break;
        case 'cmi.score.scaled':
          return '';
          break;
        case 'cmi.exit':
          status = api.LMSGetValue('cmi.core.lesson_status');
          if(status == 'completed' || status == 'passed' ) {
            return api.LMSSetValue('cmi.core.exit', '');
          }
          return api.LMSSetValue('cmi.core.exit', val);
          break;
        case 'cmi.suspend_data':
          status = api.LMSGetValue('cmi.core.lesson_status');
          if(status == 'completed' || status == 'passed' ) {
            return api.LMSSetValue('cmi.suspend_data', '');
          }
          break;
        case 'cmi.location':
          return api.LMSSetValue('cmi.core.lesson_location', val);
          break;
        case 'cmi.progress_measure':
          return '';
          break;
        case 'cmi.session_time':
          break;
        case 'cmi.completion_status':
        case 'cmi.success_status':
          if(val == 'passed' || val ==' completed') {
            api.LMSSetValue('cmi.suspend_data', "");
            api.LMSSetValue('cmi.core.lesson_location', '-');
            api.LMSSetValue('cmi.core.exit', "");
          }
          return api.LMSSetValue('cmi.core.lesson_status', val);
          break;
        default: 
          return api.LMSSetValue(key, val);
          break;
      }
    }
    return '';
  };

  API_1484_11.Commit = function() {
    this.log('Commit');
    var api = this.getAPIHandle();
    if(!this.noAPIFound){
      return api.LMSCommit("");
    }
    return false;
  };

  API_1484_11.GetLastError = function() {
    var api = this.getAPIHandle();
    if(!this.noAPIFound){
      this.log('GetLastError :' + api.LMSGetLastError());
      return api.LMSGetLastError();
    }
    return '301';
  };

  API_1484_11.GetErrorString = function(errorCode) {
    var api = this.getAPIHandle();
    if(!this.noAPIFound){
      this.log('GetErrorString : ' + api.LMSGetErrorString(errorCode));
      return api.LMSGetErrorString(errorCode);
    }
    return 'Not initialized';
  };

  API_1484_11.GetDiagnostic = function(errorCode) {
    var api = this.getAPIHandle();
    if(!this.noAPIFound){
      this.log('GetDiagnostic : ' + api.LMSGetDiagnostic(errorCode));
      return api.LMSGetDiagnostic(errorCode);
    }
    return 'Not initialized';
  };

  API_1484_11.setDebug = function(value) {
    this.debug = value;
  };

  API_1484_11.log = function(value) {
    if(this.debug) {
      console.log(value);
    }
  };

  // Gestion du temps
  API_1484_11.formatTime=function(ts){
    var sec = (ts % 60);
    ts -= sec;
    var tmp = (ts % 3600);  //# of seconds in the total # of minutes
    ts -= tmp;              //# of seconds in the total # of hours

    // convert seconds to conform to CMITimespan type (e.g. SS.00)
    sec = Math.round(sec*100)/100;
    
    var strSec = new String(sec);
    var strWholeSec = strSec;
    var strFractionSec = "";
    if (strSec.indexOf(".") != -1)
    {
      strWholeSec =  strSec.substring(0, strSec.indexOf("."));
      strFractionSec = strSec.substring(strSec.indexOf(".")+1, strSec.length);
    }
    
    if (strWholeSec.length < 2)
    {
      strWholeSec = "0" + strWholeSec;
    }
    strSec = strWholeSec;
    
    if (strFractionSec.length)
    {
      strSec = strSec+ "." + strFractionSec;
    }

    if ((ts % 3600) != 0 )
      var hour = 0;
    else var hour = (ts / 3600);
    if ( (tmp % 60) != 0 )
      var min = 0;
    else var min = (tmp / 60);

    if ((new String(hour)).length < 2)
      hour = "0"+hour;
    if ((new String(min)).length < 2)
      min = "0"+min;

    var rtnVal = hour+":"+min+":"+strSec;

    return rtnVal;
  };
  // rÃ©cup de l'API
  API_1484_11.findAPI=function( win ){
    var theAPI=null;
    while ((win.API == null) &&(win.parent != null) &&(win.parent != win) ){
      this.findAPITries++;
      if ( this.findAPITries > 500 ){
        alert( "Error finding API -- too deeply nested." );
        return null;
      }
      win = win.parent;
    }
    if(win.API != null){
      theAPI=win.API;
    }
    return theAPI;
  };

  API_1484_11.getAPI=function()
  {
    var theAPI = this.findAPI(window);
    if ( (theAPI == null) &&(window.opener != null) &&(typeof(window.opener) != "undefined") )
    {
      theAPI = this.findAPI( window.opener );
    }
    if (theAPI == null){
      alert( "Unable to locate the LMS's API Implementation.\n" + "Communication with the LMS will not occur." );
      this.noAPIFound = true;
    }
    return theAPI;
  };
  API_1484_11.getAPIHandle=function()
  {
    if (this.apiHandle == null){
      if (this.noAPIFound == false){
        this.apiHandle = this.getAPI();
      }
    }
    return this.apiHandle;
  };
 document.addEventListener('DOMContentLoaded', function(evt){
    document.getElementById('scorm-container').src="./content/index.html";
 });
  </script>
  <style>
    
    .iframe-container iframe {
      border: 0;
      height: 100%;
      left: 0;
      position: absolute;
      top: 0;
      width: 100%;
    }
  </style>
  <title></title>
</head>
<body>
  <div class="iframe-container">
    <iframe id="scorm-container"></iframe>
  </div>
</body>
</html>